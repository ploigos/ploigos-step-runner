<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.1">
<title>ploigos_step_runner.step_implementers.deploy.argocd_deploy API documentation</title>
<meta name="description" content="`StepImplementer` for the `deploy` step using ArgoCD â€¦">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>ploigos_step_runner.step_implementers.deploy.argocd_deploy</code></h1>
</header>
<section id="section-intro">
<p><code>StepImplementer</code> for the <code>deploy</code> step using ArgoCD.</p>
<h2 id="step-configuration">Step Configuration</h2>
<p>Step configuration expected as input to this step.
Could come from:</p>
<ul>
<li>static configuration</li>
<li>runtime configuration</li>
<li>previous step results</li>
</ul>
<table>
<thead>
<tr>
<th>Configuration Key</th>
<th>Required?</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>argocd-username</code></td>
<td>Yes</td>
<td></td>
<td>Username for accessing the ArgoCD API</td>
</tr>
<tr>
<td><code>argocd-password</code></td>
<td>Yes</td>
<td></td>
<td>Password for accessing the ArgoCD API</td>
</tr>
<tr>
<td><code>argocd-api</code></td>
<td>Yes</td>
<td></td>
<td>The ArgoCD API endpoint</td>
</tr>
<tr>
<td><code>argocd-auto-sync</code></td>
<td>Yes</td>
<td>True</td>
<td>If set to false, argo cd will sync only if
explicitly told to do so via the UI or CLI.
Otherwise it will sync if the repo contents have changed.</td>
</tr>
<tr>
<td><code>argocd-fail-on-shared-resource</code></td>
<td>Yes</td>
<td>False</td>
<td>If set to false, argo cd will apply all manifests
found in the git path configured in the Application
regardless if the resources defined in the yamls are
already applied by another Application.
Otherwise it will fail the sync whenever it finds a
resource in the current Application that is already
applied in the cluster by another Application.</td>
</tr>
<tr>
<td><code>argocd-skip-tls</code></td>
<td>Yes</td>
<td>False</td>
<td><code>False</code> to not ignore TLS issues when
authenticating with ArgoCD. True` to ignore TLS
issues when authenticating with ArgoCD.</td>
</tr>
<tr>
<td><code>argocd-sync-timeout-seconds</code></td>
<td>Yes</td>
<td>60</td>
<td>Number of seconds to wait for argocd to sync updates</td>
</tr>
<tr>
<td><code>argocd-sync-retry-limit</code></td>
<td>No</td>
<td>3</td>
<td>Value to pass to retry limit flag for argo sync</td>
</tr>
<tr>
<td><code>argocd-sync-prune</code></td>
<td>No</td>
<td>True</td>
<td></td>
</tr>
<tr>
<td><code>argocd-project</code></td>
<td>Yes</td>
<td>default</td>
<td>ArgoCD Project to create/update the ArgoCD Application in</td>
</tr>
<tr>
<td><code>argocd-add-or-update-target-cluster</code></td>
<td>No</td>
<td>True</td>
<td><code>True</code> to automatically add or update target cluster information.
<code>False</code> to assume target cluster already in place.</td>
</tr>
<tr>
<td><code>deployment-namespace</code></td>
<td>No</td>
<td></td>
<td>If not provided namespace name will be automatically generated</td>
</tr>
<tr>
<td><code>deployment-config-repo</code></td>
<td>Yes</td>
<td></td>
<td>The repo containing the helm chart definition</td>
</tr>
<tr>
<td><code>deployment-config-helm-chart-path</code></td>
<td>Yes</td>
<td>./</td>
<td>Directory containing the helm chart definition</td>
</tr>
<tr>
<td><code>deployment-config-helm-chart-environment-values-file</code></td>
<td>No</td>
<td>values-{ENV}.yaml</td>
<td>File to update with environment deployment specific information.
<br/>
Default value uses <code>environment</code> configuration option to calculate file name.</td>
</tr>
<tr>
<td><code>deployment-config-helm-chart-additional-values-files</code></td>
<td>No</td>
<td></td>
<td>Array of additional values files.
Paths must be relative to the given Helm Chart path (<code>deployment-config-helm-chart-path</code>).
<br/>
Does not need to include <code>deployment-config-helm-chart-environment-values-file</code>
as it will be automatically included as the last <code>--values</code> flag.</td>
</tr>
<tr>
<td><br/>
Used when createing the ArgoCD Application.
<br/><br/>
<strong>NOTE:</strong> Helm will always pick up <code>values.yaml</code>
by default whether or not additional values
files are provided, therefor no need to
explicitly provide.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>[deployment-config-helm-chart-values-file-container-image-address-yq-path,
deployment-config-helm-chart-values-file-image-tag-yq-path]</code></td>
<td>Yes</td>
<td><code>image</code></td>
<td>YQ path to value in <code>deployment-config-helm-chart-environment-values-file</code>
to update with the latest container image address before deployment.
<br/>
<strong>SEE:</strong>: <a href="https://github.com/mikefarah/yq">https://github.com/mikefarah/yq</a> for documentation on valid yq paths.</td>
</tr>
<tr>
<td><code>kube-api-uri</code></td>
<td>Yes</td>
<td><a href="https://kubernetes.default.svc">https://kubernetes.default.svc</a></td>
<td>k8s API endpoint</td>
</tr>
<tr>
<td><code>kube-api-token</code></td>
<td>No</td>
<td></td>
<td>k8s API token. This is used to add an external
k8s cluster into argocd. It is required if the
cluster has not already been added to ArgoCD.
The token should be persistent
(.e.g, a service account token) and have cluster
admin access.</td>
</tr>
<tr>
<td><code>kube-api-skip-tls</code></td>
<td>Yes</td>
<td>False</td>
<td>Whether or not to skip tls verification when
authenticating to an external k8s cluster.
Used when a new cluster is registered with
argocd.</td>
</tr>
<tr>
<td><code>git-email</code></td>
<td>Yes</td>
<td></td>
<td>Git email for commit</td>
</tr>
<tr>
<td><code>git-name</code></td>
<td>Yes</td>
<td><code>Ploigos Robot</code></td>
<td>Git name for commit</td>
</tr>
<tr>
<td><code>git-username</code></td>
<td>No</td>
<td></td>
<td>If the helm config repo s accessed via http(s) this must be supplied</td>
</tr>
<tr>
<td><code>git-password</code></td>
<td>No</td>
<td></td>
<td>If the helm config repo is accessed via http(s) this must be supplied</td>
</tr>
<tr>
<td><code>tag</code></td>
<td>No</td>
<td>latest</td>
<td>The git tag to apply to the config repo.
If not supplied <code>version</code> will be used.
If <code>version</code> not supplied <code>latest</code> will be used.</td>
</tr>
<tr>
<td><code>version</code></td>
<td>No</td>
<td>latest</td>
<td>Ignored if <code>tag</code> is provided.
The git tag to apply to the config repo if <code>tag</code> is not supplied.
If <code>tag</code> and <code>version</code> not supplied <code>latest</code> will be used.</td>
</tr>
<tr>
<td><code>tag-suffix</code></td>
<td>No</td>
<td></td>
<td>Append to the end of git tag to apply to the repo.
If <code>tag</code> is supplied git tag will be <code>tag</code>-<code>tag-suffix</code>.
If <code>tag</code> is not supplied <code>version</code>-<code>tag-suffix</code> will be used.
If <code>tag</code> and <code>version</code> not supplied <code>latest</code> will be used and <code>tag-suffix</code> will be ignored.</td>
</tr>
<tr>
<td><code>force-push-tags</code></td>
<td>No</td>
<td>False</td>
<td>Force push Git Tags</td>
</tr>
<tr>
<td><code>additional-helm-values-files</code></td>
<td>No</td>
<td>[]</td>
<td>Array of value files to add to argocd app for helm use</td>
</tr>
<tr>
<td><code>[container-image-pull-registry,
container-image-push-registry,
container-image-registry]</code></td>
<td>Maybe</td>
<td></td>
<td>If <code>use-container-image-short-addres</code> is <code>True</code>,
container image registry to pull container image from when deploying.</td>
</tr>
</tbody>
</table>
<p><code>[container-image-pull-repository,
container-image-push-repository,
container-image-repository]</code>
| Yes
|
| Container image repository within the given container image registry
to pull container image from when deploying.
<code>[container-image-pull-digest,
container-image-push-digest,
container-image-digest]
| Maybe
|
| If</code>use-container-image-digest<code>is &lt;code&gt;True&lt;/code&gt;,
container image digest to pull container image with when deploying.</code>[container-image-pull-tag,
container-image-push-tag,
container-image-tag]
| Maybe
|
| If <code>use-container-image-digest</code> is <code>False</code>,
container image tag to pull container image with when deploying.
<code>use-container-image-short-addres</code>
| No
| <code>False</code>
| If <code>True</code> then use container image short address (no registry).
If <code>False</code> then use container image full address (including registry).
<code>use-container-image-digest</code>
| No
| <code>True</code>
| If <code>True</code> then use container image digest in container image address when
pulling container image for deployment.<br/>
If <code>False</code> then use container image tag in container image address when
pulling container image for deployment.
<code>organization</code>
| Yes
|
| Used to build ArgoCD application name.
<code>application-name</code>
| Yes
|
| Used to build ArgoCD application name.
<code>service-name</code>
| Yes
|
| Used to build ArgoCD application name.
<code>branch</code>
| Yes
|
| Used to build ArgoCD application name.</p>
<h2 id="results">Results</h2>
<p>Results output by this step.</p>
<table>
<thead>
<tr>
<th>Result Key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>argocd-app-name</code></td>
<td>The argocd app name that was created or updated</td>
</tr>
<tr>
<td><code>deployed-host-urls</code></td>
<td>The host URLs deployed by ArgoCD (Ingress/Route resources)</td>
</tr>
<tr>
<td><code>config-repo-git-tag</code></td>
<td>The git tag applied to the configuration repo for deployment</td>
</tr>
<tr>
<td><code>argocd-deployed-manifest</code></td>
<td>The generated yml file used for deployment.</td>
</tr>
<tr>
<td><code>container-image-deployed-address</code></td>
<td>Container image address that was deployed.</td>
</tr>
</tbody>
</table>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="ploigos_step_runner.step_implementers.deploy.argocd_deploy.ArgoCDDeploy"><code class="flex name class">
<span>class <span class="ident">ArgoCDDeploy</span></span>
<span>(</span><span>workflow_result, parent_work_dir_path, config, environment=None)</span>
</code></dt>
<dd>
<div class="desc"><p><code>StepImplementer</code> for the <code>deploy</code> step using ArgoCD.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ArgoCDDeploy(ContainerDeployMixin, ArgoCDGeneric):
    &#34;&#34;&#34;`StepImplementer` for the `deploy` step using ArgoCD.
    &#34;&#34;&#34;

    @staticmethod
    def step_implementer_config_defaults():
        &#34;&#34;&#34;Getter for the StepImplementer&#39;s configuration defaults.

        Returns
        -------
        dict
            Default values to use for step configuration values.

        Notes
        -----
        These are the lowest precedence configuration values.
        &#34;&#34;&#34;
        return {**ContainerDeployMixin.step_implementer_config_defaults(), **DEFAULT_CONFIG}

    @staticmethod
    def _required_config_or_result_keys():
        &#34;&#34;&#34;Getter for step configuration or previous step result artifacts that are required before
        running this step.

        See Also
        --------
        _validate_required_config_or_previous_step_result_artifact_keys

        Returns
        -------
        array_list
            Array of configuration keys or previous step result artifacts
            that are required before running the step.
        &#34;&#34;&#34;
        return REQUIRED_CONFIG_OR_PREVIOUS_STEP_RESULT_ARTIFACT_KEYS + \
            ContainerDeployMixin._required_config_or_result_keys()

    def _validate_required_config_or_previous_step_result_artifact_keys(self):
        &#34;&#34;&#34;Validates that the required configuration keys or previous step result artifacts
        are set and have valid values.

        Validates that:
        * required configuration is given
        * either both git-username and git-password are set or neither.

        Raises
        ------
        StepRunnerException
            If step configuration or previous step result artifacts have invalid required values
        &#34;&#34;&#34;
        super()._validate_required_config_or_previous_step_result_artifact_keys()

        # ensure either both git-username and git-password are set or neither
        runtime_auth_config = {}
        for auth_config_key in GIT_AUTHENTICATION_CONFIG:
            runtime_auth_config_value = self.get_value(auth_config_key)

            if runtime_auth_config_value is not None:
                runtime_auth_config[auth_config_key] = runtime_auth_config_value

        if (any(element in runtime_auth_config for element in GIT_AUTHENTICATION_CONFIG)) and \
                (not all(element in runtime_auth_config for element in GIT_AUTHENTICATION_CONFIG)):
            raise StepRunnerException(
                &#34;Either &#39;git-username&#39; or &#39;git-password &#39;is not set. Neither or both must be set.&#34;
            )

        # ensure if deployment config repo is using http/https that user/pass is provided
        deployment_config_repo_uri = self.get_value(&#39;deployment-config-repo&#39;)
        if re.match(r&#39;^http://|^https://&#39;, deployment_config_repo_uri) and not runtime_auth_config:
            raise StepRunnerException(
                f&#34;Since provided &#39;deployment-config-repo&#39; ({deployment_config_repo_uri}) uses&#34;
                f&#34; http/https protical both &#39;git-username&#39; and &#39;git-password&#39; must be provided.&#34;
            )

    def _run_step(self):  # pylint: disable=too-many-locals, too-many-statements
        &#34;&#34;&#34;Runs the step implemented by this StepImplementer.

        Returns
        -------
        StepResult
            Object containing the dictionary results of this step.
        &#34;&#34;&#34;
        step_result = StepResult.from_step_implementer(self)

        # get input
        deployment_config_repo = self.get_value(&#39;deployment-config-repo&#39;)
        deployment_config_repo_branch = self._get_repo_branch()
        deployment_config_helm_chart_path = self.get_value(&#39;deployment-config-helm-chart-path&#39;)
        deployment_config_destination_cluster_uri = self.get_value(&#39;kube-api-uri&#39;)
        deployment_config_destination_cluster_token = self.get_value(&#39;kube-api-token&#39;)
        deployment_config_helm_chart_environment_values_file = \
            self._get_deployment_config_helm_chart_environment_values_file()
        deployment_config_helm_chart_values_file_container_image_address_yq_path = self.get_value([
            &#39;deployment-config-helm-chart-values-file-container-image-address-yq-path&#39;,
            &#39;deployment-config-helm-chart-values-file-image-tag-yq-path&#39;
        ])
        deployment_config_helm_chart_additional_value_files = \
            self.get_value(&#39;deployment-config-helm-chart-additional-values-files&#39;)
        force_push_tags = self.get_value(&#39;force-push-tags&#39;)
        additional_helm_values_files = self.get_value(&#39;additional-helm-values-files&#39;)

        try:
            argocd_app_name = self._get_app_name()
            step_result.add_artifact(
                name=&#39;argocd-app-name&#39;,
                value=argocd_app_name
            )

            # clone the configuration repository
            print(&#34;Clone the configuration repository&#34;)
            deployment_config_repo_dir = self.create_working_dir_sub_dir(&#39;deployment-config-repo&#39;)

            clone_repo(
                repo_dir=deployment_config_repo_dir,
                repo_url=deployment_config_repo,
                username = self.get_value(&#39;git-username&#39;),
                password = self.get_value(&#39;git-password&#39;)
            )
            git_config(
                repo_dir=deployment_config_repo_dir,
                git_email=self.get_value(&#39;git-email&#39;),
                git_name=self.get_value(&#39;git-name&#39;),
            )
            git_checkout(
                repo_dir=deployment_config_repo_dir,
                repo_branch=deployment_config_repo_branch,
            )

            # update values file, commit it, push it, and tag it
            print(&#34;Update the environment values file&#34;)
            deployment_config_helm_chart_environment_values_file_path = os.path.join(
                deployment_config_repo_dir,
                deployment_config_helm_chart_path,
                deployment_config_helm_chart_environment_values_file
            )
            container_image_address = self._get_deploy_time_container_image_address()
            self._update_yaml_file_value(
                file=deployment_config_helm_chart_environment_values_file_path,
                yq_path=deployment_config_helm_chart_values_file_container_image_address_yq_path,
                value=container_image_address
            )
            step_result.add_artifact(
                name=&#39;container-image-deployed-address&#39;,
                value=container_image_address,
                description=&#39;Container image address used to deploy the container.&#39;
            )

            print(&#34;Commit the updated environment values file&#34;)
            git_commit_file(
                git_commit_message=f&#39;Updating values for deployment to {self.environment}&#39;,
                file_path=os.path.join(
                    deployment_config_helm_chart_path,
                    deployment_config_helm_chart_environment_values_file
                ),
                repo_dir=deployment_config_repo_dir
            )

            print(&#34;Tag and push the updated environment values file&#34;)
            deployment_config_repo_tag = self._get_deployment_config_repo_tag()
            self._git_tag_and_push_deployment_config_repo(
                deployment_config_repo=deployment_config_repo,
                deployment_config_repo_dir=deployment_config_repo_dir,
                deployment_config_repo_tag=deployment_config_repo_tag,
                force_push_tags=force_push_tags
            )
            step_result.add_artifact(
                name=&#39;config-repo-git-tag&#39;,
                value=deployment_config_repo_tag
            )

            # create/update argocd app and sync it
            print(&#34;Sign into ArgoCD&#34;)
            self._argocd_sign_in(
                argocd_api=self.get_value(&#39;argocd-api&#39;),
                username=self.get_value(&#39;argocd-username&#39;),
                password=self.get_value(&#39;argocd-password&#39;),
                insecure=self.get_value(&#39;argocd-skip-tls&#39;)
            )

            add_or_update_target_cluster = self.get_value(&#39;argocd-add-or-update-target-cluster&#39;)
            if add_or_update_target_cluster:
                print(&#34;Add target cluster to ArgoCD&#34;)
                self._argocd_add_target_cluster(
                    kube_api=deployment_config_destination_cluster_uri,
                    kube_api_token=deployment_config_destination_cluster_token,
                    kube_api_skip_tls=self.get_value(&#39;kube-api-skip-tls&#39;)
                )

            print(&#34;Determine deployment namespace&#34;)
            deployment_namespace = self.get_value(&#39;deployment-namespace&#39;)
            if deployment_namespace:
                print(f&#34;  Using user provided namespace name: {deployment_namespace}&#34;)
            else:
                deployment_namespace = argocd_app_name
                print(f&#34;  Using auto generated namespace name: {deployment_namespace}&#34;)

            print(f&#34;Create or update ArgoCD Application ({argocd_app_name})&#34;)
            argocd_values_files = []
            argocd_values_files += deployment_config_helm_chart_additional_value_files
            argocd_values_files += [deployment_config_helm_chart_environment_values_file]
            argocd_values_files += additional_helm_values_files
            self._argocd_app_create_or_update(
                argocd_app_name=argocd_app_name,
                repo=deployment_config_repo,
                revision=deployment_config_repo_tag,
                path=deployment_config_helm_chart_path,
                dest_server=deployment_config_destination_cluster_uri,
                dest_namespace=deployment_namespace,
                auto_sync=self.get_value(&#39;argocd-auto-sync&#39;),
                fail_on_shared_resource=self.get_value(&#39;argocd-fail-on-shared-resource&#39;),
                values_files=argocd_values_files,
                project=self.get_value(&#39;argocd-project&#39;)
            )

            # sync and wait for the sync of the ArgoCD app
            print(f&#34;Sync (and wait for) ArgoCD Application ({argocd_app_name})&#34;)
            self._argocd_app_sync(
                argocd_app_name=argocd_app_name,
                argocd_sync_timeout_seconds=self.get_value(&#39;argocd-sync-timeout-seconds&#39;),
                argocd_sync_retry_limit=self.get_value(&#39;argocd-sync-retry-limit&#39;),
                argocd_sync_prune=self.get_value(&#39;argocd-sync-prune&#39;)
            )

            # get the ArgoCD app manifest that was synced
            print(f&#34;Get ArgoCD Application ({argocd_app_name}) synced manifest&#34;)
            argocd_app_manifest_file = self._argocd_get_app_manifest(
                argocd_app_name=argocd_app_name
            )
            step_result.add_artifact(
                name=&#39;argocd-deployed-manifest&#39;,
                value=argocd_app_manifest_file
            )

            # determine the deployed host URLs
            print(
                &#34;Determine the deployed host URLs for the synced&#34;
                f&#34; ArgoCD Application (({argocd_app_name})&#34;
            )
            deployed_host_urls = self._get_deployed_host_urls(
                manifest_path=argocd_app_manifest_file
            )
            step_result.add_artifact(
                name=&#39;deployed-host-urls&#39;,
                value=deployed_host_urls
            )
        except StepRunnerException as error:
            step_result.success = False
            step_result.message = f&#34;Error deploying to environment ({self.environment}):&#34; \
                                  f&#34; {str(error)}&#34;

        return step_result</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li><a title="ploigos_step_runner.step_implementers.shared.container_deploy_mixin.ContainerDeployMixin" href="../shared/container_deploy_mixin.html#ploigos_step_runner.step_implementers.shared.container_deploy_mixin.ContainerDeployMixin">ContainerDeployMixin</a></li>
<li><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric" href="../shared/argocd_generic.html#ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric">ArgoCDGeneric</a></li>
<li><a title="ploigos_step_runner.step_implementer.StepImplementer" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer">StepImplementer</a></li>
<li>abc.ABC</li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="ploigos_step_runner.step_implementers.deploy.argocd.ArgoCD" href="argocd.html#ploigos_step_runner.step_implementers.deploy.argocd.ArgoCD">ArgoCD</a></li>
</ul>
<h3>Inherited members</h3>
<ul class="hlist">
<li><code><b><a title="ploigos_step_runner.step_implementers.shared.container_deploy_mixin.ContainerDeployMixin" href="../shared/container_deploy_mixin.html#ploigos_step_runner.step_implementers.shared.container_deploy_mixin.ContainerDeployMixin">ContainerDeployMixin</a></b></code>:
<ul class="hlist">
<li><code><a title="ploigos_step_runner.step_implementers.shared.container_deploy_mixin.ContainerDeployMixin.step_implementer_config_defaults" href="../shared/container_deploy_mixin.html#ploigos_step_runner.step_implementers.shared.container_deploy_mixin.ContainerDeployMixin.step_implementer_config_defaults">step_implementer_config_defaults</a></code></li>
</ul>
</li>
<li><code><b><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric" href="../shared/argocd_generic.html#ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric">ArgoCDGeneric</a></b></code>:
<ul class="hlist">
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.argocd_api" href="../shared/argocd_generic.html#ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.argocd_api">argocd_api</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.argocd_password" href="../shared/argocd_generic.html#ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.argocd_password">argocd_password</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.argocd_skip_tls" href="../shared/argocd_generic.html#ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.argocd_skip_tls">argocd_skip_tls</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.argocd_username" href="../shared/argocd_generic.html#ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.argocd_username">argocd_username</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.config" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.config">config</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.create_working_dir_sub_dir" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.create_working_dir_sub_dir">create_working_dir_sub_dir</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.environment" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.environment">environment</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.get_config_value" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.get_config_value">get_config_value</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.get_copy_of_runtime_step_config" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.get_copy_of_runtime_step_config">get_copy_of_runtime_step_config</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.get_result_value" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.get_result_value">get_result_value</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.get_value" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.get_value">get_value</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.global_config_defaults" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.global_config_defaults">global_config_defaults</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.global_environment_config_defaults" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.global_environment_config_defaults">global_environment_config_defaults</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.has_config_value" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.has_config_value">has_config_value</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.run_step" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.run_step">run_step</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.step_config" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.step_config">step_config</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.step_config_overrides" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.step_config_overrides">step_config_overrides</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.step_environment_config" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.step_environment_config">step_environment_config</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.step_name" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.step_name">step_name</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.sub_step_implementer_name" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.sub_step_implementer_name">sub_step_implementer_name</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.sub_step_name" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.sub_step_name">sub_step_name</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.work_dir_path" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.work_dir_path">work_dir_path</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.workflow_result" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.workflow_result">workflow_result</a></code></li>
<li><code><a title="ploigos_step_runner.step_implementers.shared.argocd_generic.ArgoCDGeneric.write_working_file" href="../../step_implementer.html#ploigos_step_runner.step_implementer.StepImplementer.write_working_file">write_working_file</a></code></li>
</ul>
</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul>
<li><a href="#step-configuration">Step Configuration</a></li>
<li><a href="#results">Results</a></li>
</ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="ploigos_step_runner.step_implementers.deploy" href="index.html">ploigos_step_runner.step_implementers.deploy</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="ploigos_step_runner.step_implementers.deploy.argocd_deploy.ArgoCDDeploy" href="#ploigos_step_runner.step_implementers.deploy.argocd_deploy.ArgoCDDeploy">ArgoCDDeploy</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.1</a>.</p>
</footer>
</body>
</html>
